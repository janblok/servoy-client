<!DOCTYPE html>
<html ng-app="servoyApp" ng-controller="MainController">
	<head>
		<meta http-equiv="X-UA-Compatible" content="IE=Edge">
		<title ng-bind="solutionSettings.solutionTitle"></title>
		<!-- base 3th party libraries -->
		<link rel="stylesheet" href="css/bootstrap/css/bootstrap.css">
		<link rel="stylesheet" href="js/bootstrap-window/css/bootstrap-window.css">
		
		<script src="js/jquery-1.11.1.js"></script>
		<script src="js/angular_1.4.0b5.js"></script>
		<script src="js/angular-webstorage.js"></script>
		<script src="js/angularui/ui-bootstrap-tpls-0.12.0.js"></script>
		<script src="js/numeral.js"></script>
		<script src="js/languages.js"></script>
		<script src="js/angular-file-upload/dist/angular-file-upload.min.js"></script>
		<script src="js/bootstrap-window/js/Window.js"></script>    <!-- TODO replace these with bootstrap-window.min.js --> 
		<script src="js/bootstrap-window/js/WindowManager.js"></script>	<!-- see ^ -->
		<script src="js/bindonce.js"></script>	
		
		<!-- base servoy libraries -->
		<script src="js/servoy.js"></script>
		<script src="js/servoyWindowManager.js"></script>
		<script src="js/servoyformat.js"></script>
		<script src="js/servoytooltip.js"></script>
		<script src="js/fileupload.js"></script>
		<script src="js/servoy-components.js"></script>
		<script src="sablo/lib/reconnecting-websocket.js"></script>
		<script src="sablo/js/websocket.js"></script>
		<script src="sablo/js/sablo_app.js"></script>
		<script src="js/servoy_app.js"></script>
		<script src="js/jquery.maskedinput.js"></script>
		<!-- component_contributions -->
		<link rel="stylesheet" ng-href='{{solutionSettings.styleSheetPath}}'>
	</head>
	<script type="text/javascript">
		var isOldBrowser = function(){
			// code from http://www.javascripter.net/faq/browsern.htm
			var nVer = navigator.appVersion;
			var nAgt = navigator.userAgent;
			var browserName  = navigator.appName;
			var fullVersion  = ''+parseFloat(navigator.appVersion); 
			var majorVersion = parseInt(navigator.appVersion,10);
			var nameOffset,verOffset,ix;
	
			// In Opera 15+, the true version is after "OPR/" 
			if ((verOffset=nAgt.indexOf("OPR/"))!=-1) {
				browserName = "Opera";
				fullVersion = nAgt.substring(verOffset+4);
			}
			// In older Opera, the true version is after "Opera" or after "Version"
			else if ((verOffset=nAgt.indexOf("Opera"))!=-1) {
				browserName = "Opera";
				fullVersion = nAgt.substring(verOffset+6);
				if ((verOffset=nAgt.indexOf("Version"))!=-1) 
					fullVersion = nAgt.substring(verOffset+8);
			}
			// In MSIE, the true version is after "MSIE" in userAgent
			else if ((verOffset=nAgt.indexOf("MSIE"))!=-1) {
				browserName = "Microsoft Internet Explorer";
				fullVersion = nAgt.substring(verOffset+5);
			}
			// In Chrome, the true version is after "Chrome" 
			else if ((verOffset=nAgt.indexOf("Chrome"))!=-1) {
				browserName = "Chrome";
				fullVersion = nAgt.substring(verOffset+7);
			}
			// In Safari, the true version is after "Safari" or after "Version" 
			else if ((verOffset=nAgt.indexOf("Safari"))!=-1) {
				browserName = "Safari";
				fullVersion = nAgt.substring(verOffset+7);
				if ((verOffset=nAgt.indexOf("Version"))!=-1) 
					fullVersion = nAgt.substring(verOffset+8);
			}
			// In Firefox, the true version is after "Firefox" 
			else if ((verOffset=nAgt.indexOf("Firefox"))!=-1) {
				browserName = "Firefox";
				fullVersion = nAgt.substring(verOffset+8);
			}
			// In most other browsers, "name/version" is at the end of userAgent 
			else if ( (nameOffset=nAgt.lastIndexOf(' ')+1) < 
					(verOffset=nAgt.lastIndexOf('/')) ) 
			{
				browserName = nAgt.substring(nameOffset,verOffset);
				fullVersion = nAgt.substring(verOffset+1);
				if (browserName.toLowerCase()==browserName.toUpperCase()) {
					browserName = navigator.appName;
				}
			}
			// trim the fullVersion string at semicolon/space if present
			if ((ix=fullVersion.indexOf(";"))!=-1)
				fullVersion=fullVersion.substring(0,ix);
			if ((ix=fullVersion.indexOf(" "))!=-1)
				fullVersion=fullVersion.substring(0,ix);
	
			majorVersion = parseInt(''+fullVersion,10);
			if (isNaN(majorVersion)) {
				fullVersion  = ''+parseFloat(navigator.appVersion); 
				majorVersion = parseInt(navigator.appVersion,10);
			}
			
			if (browserName == "Microsoft Internet Explorer" && majorVersion <= 9)
			{
				return true;
			}	
			if (browserName == "Opera" && majorVersion <= 11)
			{
				return true;
			}
			if (browserName == "Chrome" && majorVersion <= 15)
			{
				return true;
			}
			if (browserName == "Firefox" && majorVersion <= 10)
			{
				return true;
			}
			if (browserName == "Safari" && majorVersion <= 6)
			{
				return true;
			}
			return false;
		}
		if (isOldBrowser())
		{
			window.location = '/templates/notSupportedBrowser.html';
		}	
	</script>
	<script type="text/javascript">
		angular.module('servoyApp').run(function($solutionSettings){
				var orientation = ##orientation##;
				if (orientation == 2)
				{
					$solutionSettings.ltrOrientation = false;
				}
				else if (orientation == 3)
				{
					language = window.navigator.language?window.navigator.language:window.navigator.browserLanguage;
					language = language.split('-')[0];
					if (language == 'iw' || language == 'ar' ||language == 'fa' ||language == 'ur')
					{
						$solutionSettings.ltrOrientation = false;
					}
					else
					{
						$solutionSettings.ltrOrientation = true;
					}
				}
				else
				{
					$solutionSettings.ltrOrientation = true;
				}
		});
	</script>
	<body dir="{{solutionSettings.ltrOrientation ? 'ltr' : 'rtl'}}" sablo-tabseq="1" sablo-tabseq-config="{root: true}">
	
	    <div sablo-reconnecting-feedback>Disconnected from server, Reconnecting....</div>
	
		<div ng-if='!getSessionProblemView()' id="mainForm" sablo-tabseq='1' sablo-tabseq-config="{container: true}">
			<div ng-if="solutionSettings.navigatorForm.name" ng-style="getNavigatorStyle(solutionSettings.ltrOrientation)"
				ng-include="getNavigatorFormUrl()"></div>
			<div ng-include="getMainFormUrl()" ng-style="getFormStyle(solutionSettings.ltrOrientation)"></div>
			<div hiddendiv="true" ng-include="updatingFormUrl" style="position:absolute;visibility:hidden;"></div>
		</div>
		<div ng-if='getSessionProblemView()' ng-include='getSessionProblemView()'>		  
		</div>
	</body>
</html>
